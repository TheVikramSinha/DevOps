<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timed DevOps Assessment</title>
    <style>
        /* CSS for Typeform-like UI */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f7f6;
            color: #333;
            transition: background-color 0.5s;
        }
        #quiz-container {
            background: white;
            padding: 40px 60px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 700px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .question-slide {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .question-slide.active {
            display: block;
            opacity: 1;
        }
        h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 10px;
        }
        .scenario-text {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.5;
            padding: 15px;
            background-color: #eef3f5;
            border-left: 5px solid #007bff;
            border-radius: 4px;
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            background: white;
            font-size: 1.05em;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1.4;
        }
        .option-button:hover {
            border-color: #007bff;
            background-color: #f0f8ff;
        }
        .option-button.selected {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        #navigation {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 30px;
        }
        .nav-button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #next-button {
            background-color: #007bff;
            color: white;
        }
        #next-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #result-screen {
            text-align: center;
            padding: 50px 0;
        }
        #result-screen h2 {
            font-size: 2.5em;
            color: #28a745;
        }
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #007bff;
            width: 0%;
            transition: width 0.3s ease-in-out;
        }
        #timer-display {
            font-size: 1.2em;
            font-weight: bold;
            color: #dc3545; /* Red color for urgency */
            text-align: right;
            margin-bottom: 20px;
        }
        /* Style for the start screen */
        #start-screen {
            text-align: center;
            padding: 50px 20px;
        }
        #start-screen h1 {
            color: #007bff;
            font-size: 2.5em;
        }
        #start-button {
            background-color: #007bff;
            color: white;
            padding: 15px 40px;
            font-size: 1.4em;
            border-radius: 8px;
            margin-top: 30px;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }
        #start-button:hover {
            background-color: #0056b3;
        }
        .instruction-item {
            text-align: left;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .important-note {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="quiz-container">
    
    <div id="start-screen">
        <h1>DevOps Scenario Assessment</h1>
        <p style="margin-top: 20px; font-size: 1.2em;">Welcome to the timed technical assessment. Please read the instructions carefully before starting.</p>
        
        <hr style="margin: 25px 0;">

        <div class="instruction-item">
            ‚úÖ **Total Questions:** 20 Scenario-based questions.
        </div>
        <div class="instruction-item">
            ‚è±Ô∏è **Time Limit:** You have **30 seconds** per question.
        </div>
        <div class="instruction-item important-note">
            ‚ö†Ô∏è **Critical:** The timer will start immediately upon clicking 'Start Test' and questions will auto-advance when time runs out. **There is no going back.**
        </div>
        <button id="start-button" onclick="startQuiz()">Start Test</button>
    </div>
    
    <div id="quiz-interface" style="display: none;">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div id="timer-display">Time Left: <span id="time-left">30</span>s</div>
        
        <div id="quiz-content">
            </div>
        
        <div id="result-screen" style="display: none;">
            <h2>Assessment Complete! üéâ</h2>
            <p style="font-size: 1.2em;">You have successfully completed the DevOps Scenario Assessment.</p>
            <p style="font-size: 1.5em; margin-top: 20px;">Your Score:</p>
            <p id="final-score" style="font-size: 3em; font-weight: bold; color: #007bff;">--/--</p>
            <p id="performance-feedback" style="font-size: 1.1em; color: #555;"></p>
            <button class="nav-button" onclick="window.location.reload()">Retake Assessment</button>
        </div>

        <div id="navigation">
            <button id="next-button" class="nav-button" disabled>Next ‚Üí</button>
        </div>
    </div>
</div>

<script>
    // Utility function to shuffle an array (Fisher-Yates)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[i], array[j]];
        }
        return array;
    }

    const initialQuestions = [
        // --- 20 Scenario Questions ---
        {
            scenario: "You have a NodeJS API deployed on **AWS ECS Fargate**. Developers report inconsistent high latency and occasional **OOMKilled** errors. The ECS task definition does not specify resource limits.",
            question: "What is the **most immediate** action to stabilize the service and prevent resource hogging?",
            options: [
                "Define and set **Memory and CPU Limits** in the ECS Task Definition.",
                "Increase the Fargate instance size (CPU/Memory) for the service.",
                "Implement Kubernetes HPA to automatically scale the tasks based on CPU usage.",
                "Switch the application base image from Alpine Linux to Ubuntu to improve performance."
            ],
            answerText: "Define and set **Memory and CPU Limits** in the ECS Task Definition."
        },
        {
            scenario: "A new feature deployment via your **GitHub Actions CI/CD** pipeline failed. The build stage was successful, but the final deployment step (Terraform `apply`) timed out. The change involves provisioning a new RDS instance.",
            question: "What is the **most likely** cause for a Terraform `apply` timeout when provisioning an RDS database?",
            options: [
                "RDS instance creation often takes longer than the pipeline's default timeout setting (e.g., 5-10 minutes).",
                "The GitHub Actions runner ran out of disk space during the deployment.",
                "The state file was locked by another user or process, causing a deadlock.",
                "The ECR registry was down, preventing the application image from being pulled."
            ],
            answerText: "RDS instance creation often takes longer than the pipeline's default timeout setting (e.g., 5-10 minutes)."
        },
        {
            scenario: "Your production infrastructure is entirely provisioned using **Terraform**. A colleague made a manual change directly in the AWS console (e.g., changing a Security Group rule).",
            question: "What command should you run to identify this manual drift and update your local state file **without applying** any changes to AWS?",
            options: [
                "`terraform plan`",
                "`terraform apply --auto-approve`",
                "`terraform destroy`",
                "`terraform import`"
            ],
            answerText: "`terraform plan`"
        },
        {
            scenario: "You need to automate a daily task: finding all `.log` files older than 7 days in the `/var/app/logs` directory and compressing them into a single archive.",
            question: "Which combination of **Bash commands** should you use?",
            options: [
                "`find /var/app/logs -type f -mtime +7 -name '*.log' | xargs tar -czf old_logs.tar.gz`",
                "`tar -zcvf archive.tar.gz *.log`",
                "`find /var/app/logs -type f -mtime +7 -name '*.log' -exec rm {} \\;`",
                "`grep -r '.log' /var/app/logs | zip logs.zip`"
            ],
            answerText: "`find /var/app/logs -type f -mtime +7 -name '*.log' | xargs tar -czf old_logs.tar.gz`"
        },
        {
            scenario: "A high-traffic e-commerce microservice deployed on **AWS EKS** is experiencing intermittent connection errors. You suspect network instability between pods.",
            question: "Which Kubernetes component is responsible for managing the network policies (firewall rules) between Pods in an EKS cluster?",
            options: [
                "Network Policy Controller (often implemented by CNI, like AWS VPC CNI)",
                "Kubelet",
                "CoreDNS",
                "Kubernetes Ingress Controller"
            ],
            answerText: "Network Policy Controller (often implemented by CNI, like AWS VPC CNI)"
        },
        {
            scenario: "You are setting up monitoring for a new API service. You need to track the path and latency of a single request as it passes through the Load Balancer, API Gateway, and two different Lambda functions.",
            question: "Which observability tool/technique is essential for tracking this **end-to-end request flow**?",
            options: [
                "Distributed Tracing (e.g., AWS X-Ray)",
                "ELK Stack (for centralized logging)",
                "CloudWatch Metrics (for resource utilization)",
                "Prometheus and Grafana (for time-series data)"
            ],
            answerText: "Distributed Tracing (e.g., AWS X-Ray)"
        },
        {
            scenario: "A new IAM Role needs permission to read data from only one specific S3 bucket (`my-app-data`). The current policy grants `s3:GetObject` permission on `arn:aws:s3:::*`.",
            question: "To enforce the **Principle of Least Privilege**, what is the corrective action?",
            options: [
                "Restrict the `Action` to `s3:GetObject` and change the `Resource` to `arn:aws:s3:::my-app-data/*`.",
                "Change the IAM Role to an IAM User instead.",
                "Remove the IAM role completely and use temporary security credentials.",
                "Add an explicit `Deny` statement for all other S3 buckets."
            ],
            answerText: "Restrict the `Action` to `s3:GetObject` and change the `Resource` to `arn:aws:s3:::my-app-data/*`."
        },
        {
            scenario: "You are building a Docker image for a Java application. The build process requires the JDK, but the final runtime only needs the JRE. Using a single image results in a large image size.",
            question: "What is the best Docker technique to minimize the size of the final production image?",
            options: [
                "Implementing a **Multi-Stage Build**.",
                "Using the `--squash` flag during the build process.",
                "Storing temporary files in a volume outside the container.",
                "Using the `ADD` instruction instead of `COPY`."
            ],
            answerText: "Implementing a **Multi-Stage Build**."
        },
        {
            scenario: "Your deployment strategy for a critical, stateful microservice is currently a simple **Rolling Update** on Kubernetes. You need a method to minimize downtime and provide an instant rollback capability if a failure is detected.",
            question: "Which advanced deployment strategy best meets these requirements?",
            options: [
                "Blue/Green Deployment",
                "Canary Deployment",
                "A/B Testing",
                "Feature Flags"
            ],
            answerText: "Blue/Green Deployment"
        },
        {
            scenario: "A developer is experiencing a recurring bug in a Python service only when it runs inside its container on a development machine. The service works fine locally on the host machine.",
            question: "What is the **most likely** cause, and how would you recommend they debug the Python process running inside the container?",
            options: [
                "The container is missing a crucial dependency (e.g., a library or environment variable). Debug using `docker exec -it <container> bash`.",
                "The host machine is corrupt. Reinstall the OS.",
                "Docker is incorrectly NATing the network traffic to the container.",
                "The local service uses a different Python version than the one specified in the Dockerfile."
            ],
            answerText: "The container is missing a crucial dependency (e.g., a library or environment variable). Debug using `docker exec -it <container> bash`."
        },
        {
            scenario: "You are using **Prometheus and Grafana**. You need to set up a rule that sends an email alert when the node CPU utilization exceeds 85% for more than 5 minutes.",
            question: "Which component of the Prometheus ecosystem is responsible for processing these alert rules and sending notifications?",
            options: [
                "**Alertmanager**",
                "Grafana itself (via native alerts)",
                "Prometheus Pushgateway",
                "Node Exporter"
            ],
            answerText: "**Alertmanager**"
        },
        {
            scenario: "A new engineer launches an **AWS EC2** instance in a public subnet with a default Security Group. The service is running on port 80, but they cannot access it from their web browser.",
            question: "Assuming the instance has a public IP, what is the **most common** reason for this connection failure?",
            options: [
                "The **Security Group** is not configured to allow inbound traffic on port 80.",
                "The instance is not properly tagged for cost allocation.",
                "The application is running as a non-root user.",
                "They need to set up a new NAT Gateway."
            ],
            answerText: "The **Security Group** is not configured to allow inbound traffic on port 80."
        },
        {
            scenario: "Your team is adopting a **GitOps** workflow for EKS deployments.",
            question: "Which statement accurately describes the core mechanism of GitOps?",
            options: [
                "A tool (like ArgoCD or Flux) **pulls** the desired state (manifests) from the Git repository and applies it to the cluster.",
                "Developers manually push code changes to ECR, and then run `kubectl apply` from their machine.",
                "The CI pipeline builds the image and then **pushes** the new Kubernetes manifest to the cluster.",
                "All infrastructure is written in YAML instead of Terraform."
            ],
            answerText: "A tool (like ArgoCD or Flux) **pulls** the desired state (manifests) from the Git repository and applies it to the cluster."
        },
        {
            scenario: "You need to retrieve the password for a database that is securely stored in **AWS Secrets Manager**. The application running on EC2 needs this secret.",
            question: "What is the most secure method for the EC2 application to access the secret?",
            options: [
                "Assign an **IAM Role** to the EC2 instance that grants permission to read the specific secret.",
                "Store the secret in an environment variable on the EC2 instance.",
                "Hardcode the secret in the application code but encrypt it first.",
                "Use an encrypted S3 bucket to store a configuration file containing the secret."
            ],
            answerText: "Assign an **IAM Role** to the EC2 instance that grants permission to read the specific secret."
        },
        {
            scenario: "You've successfully created a Docker image and pushed it to **ECR**. Now you need to update an existing Kubernetes Deployment to use this new image.",
            question: "What is the most direct and idiomatic Kubernetes command to roll out this new image version?",
            options: [
                "`kubectl set image deployment/app-deployment <container-name>=<ecr-repo>/my-image:v2.0`",
                "`kubectl update image deployment/app-deployment --image=my-image:latest`",
                "`kubectl rollback deployment/app-deployment`",
                "`kubectl apply -f deployment.yaml --force`"
            ],
            answerText: "`kubectl set image deployment/app-deployment <container-name>=<ecr-repo>/my-image:v2.0`"
        },
        {
            scenario: "The CTO is concerned about the high cost of **AWS RDS Multi-AZ** deployments, which are required for high availability. The database load is mostly stable.",
            question: "What is the most cost-effective long-term strategy for maintaining a stable RDS instance with predictable load?",
            options: [
                "Use **AWS Reserved Instances (RIs)** or **Savings Plans** for the RDS family.",
                "Switch to a non-relational database like DynamoDB.",
                "Implement aggressive autoscaling policies for the RDS instance.",
                "Move the database to a single-AZ deployment and rely on manual backups."
            ],
            answerText: "Use **AWS Reserved Instances (RIs)** or **Savings Plans** for the RDS family."
        },
        {
            scenario: "You are debugging a performance issue in a microservice where **CPU utilization frequently spikes** to 100% just before service degradation. You suspect it's a code issue, not resource exhaustion.",
            question: "Which type of tool or analysis would provide the most detailed insight into which function or line of code is consuming the CPU?",
            options: [
                "**Code Profiler** (e.g., Node.js/Python profiler)",
                "Centralized log analysis (ELK)",
                "AWS CloudWatch Metrics (only provides utilization rate)",
                "Network packet sniffing (tcpdump)"
            ],
            answerText: "**Code Profiler** (e.g., Node.js/Python profiler)"
        },
        {
            scenario: "Your team uses **Helm** to manage Kubernetes releases. A recent release introduced a bug, and you need to revert to the previous working configuration.",
            question: "What is the standard Helm command to quickly and safely revert to the previously deployed chart version?",
            options: [
                "`helm rollback <release-name> <revision-number>`",
                "`helm delete <release-name>`",
                "`kubectl rollout undo deployment/<name>`",
                "`helm upgrade --force <release-name>`"
            ],
            answerText: "`helm rollback <release-name> <revision-number>`"
        },
        {
            scenario: "You need to write a **CloudFormation** template that depends on the public IP address of an EC2 instance created in another, separate CloudFormation stack.",
            question: "What is the native CloudFormation mechanism used to securely pass output values between stacks?",
            options: [
                "Using **CloudFormation Exports/Imports**.",
                "Using **S3** as a common storage point for IP addresses.",
                "Hardcoding the IP address into the dependent template.",
                "Using a Lambda function to manually retrieve the IP."
            ],
            answerText: "Using **CloudFormation Exports/Imports**."
        },
        {
            scenario: "An engineer reports that a new EC2 instance in a private subnet cannot download dependencies from the internet, but the application requires outbound internet access.",
            question: "Which VPC component is required to allow instances in the private subnet to initiate **outbound** connections to the public internet?",
            options: [
                "A **NAT Gateway** or **NAT Instance**.",
                "A **Bastion Host** (or Jump Box).",
                "An **Internet Gateway (IGW)** attached to the VPC.",
                "An **Endpoint Gateway** for S3."
            ],
            answerText: "A **NAT Gateway** or **NAT Instance**."
        }
    ];

    // --- Data Preparation: Match Answer Index to Randomized Options ---
    const questions = initialQuestions.map(q => {
        const indexedOptions = q.options.map((text) => ({ text: text, isCorrect: text === q.answerText }));
        const shuffledOptions = shuffleArray(indexedOptions);
        const newAnswerIndex = shuffledOptions.findIndex(opt => opt.isCorrect);
        const finalOptions = shuffledOptions.map(opt => opt.text);
        return {
            scenario: q.scenario,
            question: q.question,
            options: finalOptions,
            answer: newAnswerIndex
        };
    });

    let currentQuestionIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let timerInterval;
    const TIME_LIMIT = 30; // Seconds per question

    const startScreen = document.getElementById('start-screen');
    const quizInterface = document.getElementById('quiz-interface');
    const quizContent = document.getElementById('quiz-content');
    const resultScreen = document.getElementById('result-screen');
    const nextButton = document.getElementById('next-button');
    const progressFill = document.getElementById('progress-fill');
    const timeLeftSpan = document.getElementById('time-left');
    const totalQuestions = questions.length;

    // --- Core Function to Start Quiz ---
    window.startQuiz = function() {
        startScreen.style.display = 'none';
        quizInterface.style.display = 'block';
        renderQuestion(currentQuestionIndex);
    }

    // --- Timer Functions ---
    function startTimer() {
        clearInterval(timerInterval);
        let timeRemaining = TIME_LIMIT;
        timeLeftSpan.textContent = timeRemaining;

        timerInterval = setInterval(() => {
            timeRemaining--;
            timeLeftSpan.textContent = timeRemaining;

            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                if (currentQuestionIndex < totalQuestions - 1) {
                    currentQuestionIndex++;
                    renderQuestion(currentQuestionIndex);
                } else {
                    showResults();
                }
            }
        }, 1000);
    }

    // --- Question Rendering ---
    function renderQuestion(index) {
        clearInterval(timerInterval);
        document.querySelectorAll('.question-slide').forEach(q => q.classList.remove('active'));

        let questionElement = document.getElementById(`q-${index}`);

        if (!questionElement) {
            const qData = questions[index];
            questionElement = document.createElement('div');
            questionElement.className = 'question-slide';
            questionElement.id = `q-${index}`;

            let optionsHtml = qData.options.map((option, optIndex) => `
                <button class="option-button" data-question-index="${index}" data-option-index="${optIndex}">
                    ${option}
                </button>
            `).join('');

            questionElement.innerHTML = `
                <h2>Question ${index + 1} of ${totalQuestions}</h2>
                <div class="scenario-text">${qData.scenario}</div>
                <p style="font-weight: bold;">${qData.question}</p>
                <div class="options-group">${optionsHtml}</div>
            `;
            quizContent.appendChild(questionElement);

            questionElement.querySelectorAll('.option-button').forEach(button => {
                button.addEventListener('click', handleOptionClick);
            });
        }
        
        setTimeout(() => { questionElement.classList.add('active'); }, 10); 
        
        // Always restart the timer when moving to a new question
        if (index >= userAnswers.findIndex(a => a === null)) {
             startTimer();
        } else {
             timeLeftSpan.textContent = '--'; 
        }

        updateNavigation();
        updateProgress();
        highlightSelectedAnswer(index);
    }

    // --- Answer Handling and Navigation Updates ---

    function handleOptionClick(event) {
        const button = event.target.closest('.option-button');
        const qIndex = parseInt(button.dataset.questionIndex);
        const oIndex = parseInt(button.dataset.optionIndex);
        userAnswers[qIndex] = oIndex;
        const optionsGroup = button.closest('.options-group');
        optionsGroup.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
        // FIX: Call updateNavigation immediately after an answer is selected
        updateNavigation(); 
    }

    function highlightSelectedAnswer(index) {
        const selectedOption = userAnswers[index];
        const currentSlide = document.getElementById(`q-${index}`);
        if (currentSlide) {
            currentSlide.querySelectorAll('.option-button').forEach((btn, optIndex) => {
                btn.classList.remove('selected');
                if (optIndex === selectedOption) {
                    btn.classList.add('selected');
                }
            });
        }
    }

    function updateNavigation() {
        // This check is now robust and runs whenever an answer is clicked
        const isAnswered = userAnswers[currentQuestionIndex] !== null; 

        if (currentQuestionIndex < totalQuestions - 1) {
            nextButton.textContent = 'Next ‚Üí';
            nextButton.disabled = !isAnswered; 
            nextButton.onclick = () => { 
                if (isAnswered) {
                    clearInterval(timerInterval);
                    currentQuestionIndex++; 
                    renderQuestion(currentQuestionIndex);
                } 
            };
        } else {
            nextButton.textContent = 'Finish & Score';
            nextButton.disabled = !isAnswered;
            nextButton.onclick = () => { 
                if (isAnswered) {
                    clearInterval(timerInterval);
                    showResults(); 
                }
            };
        }
    }

    function updateProgress() {
        const answeredCount = userAnswers.filter(a => a !== null).length;
        const progress = (answeredCount / totalQuestions) * 100;
        progressFill.style.width = `${progress}%`;
    }

    function calculateScore() {
        let score = 0;
        questions.forEach((q, index) => {
            if (userAnswers[index] === q.answer) {
                score++;
            }
        });
        return score;
    }

    function showResults() {
        clearInterval(timerInterval);
        const finalScore = calculateScore();
        const percentage = Math.round((finalScore / totalQuestions) * 100);
        
        let feedback = '';
        if (percentage >= 95) {
            feedback = "Outstanding! You demonstrate expert-level knowledge in DevOps principles and practical scenarios.";
        } else if (percentage >= 85) {
            feedback = "Very strong! You have a solid grasp of core DevOps and architecture concepts.";
        } else if (percentage >= 75) {
            feedback = "Good foundation. Focus on deeper experience in IaC, Kubernetes, and monitoring tools.";
        } else {
            feedback = "Further study is recommended in AWS security and advanced orchestration techniques.";
        }

        quizContent.style.display = 'none';
        document.getElementById('navigation').style.display = 'none';
        document.getElementById('timer-display').style.display = 'none';

        progressFill.style.width = '100%';
        resultScreen.style.display = 'block';
        document.getElementById('final-score').textContent = `${finalScore} / ${totalQuestions}`;
        document.getElementById('performance-feedback').textContent = feedback;
    }
</script>

</body>
</html>
